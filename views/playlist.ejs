<div id="errorContainer">
<%- include ("partials/messages.ejs") %>
</div>
<form id="formContainer" action="/playlist" method="POST">
    <input type="text" name="url" id="url" autocomplete="off" placeholder="Enter Youtube URL (e.g. https://youtu.be/2lAe1cqCOXo)">
    <button type="submit" class="btn btn-primary" id="add">Add</button>
    <a href="/users/logout" class="btn btn-secondary" id="logout">Logout</a>
</form>
<div id="video">
    <iframe 
        width="560" 
        height="315" 
        src="https://www.youtube.com/embed/<%= playlist[0].id %>"
        frameborder="0" 
        allow="accelerometer; 
        autoplay; 
        encrypted-media; 
        gyroscope; 
        picture-in-picture" 
        allowfullscreen>
    </iframe>
</div>
<h1 class="mt-4" id="title">My Playlist</h1>
<% if(playlist.length == 0) {%>
    <p id="emptyContainer">No playlists to display</p>
<% } else { %>
    <div id="itemContainer">
        <% for(let i=0; i<playlist.length; i++) { %>
            <article class="item" data-key="<%= playlist[i].id %>">
                <img class="item-left" src="<%= playlist[i].thumbnail %>" alt="">
                <div class="item-right">
                    <h5 class="channelTitle"><%= playlist[i].channelTitle %></h5>
                    <p class="videoTitle"><%= playlist[i].title %></p>
                </div>
            </article>
        <% } %>
    </div>
<% } %>

<script>
    const list = document.getElementById('itemContainer');
    const video = document.getElementById('video');
    list.addEventListener('click', function(e) {
        let article = e.target;
        if(e.target.tagName == 'IMG' || e.target.tagName == 'DIV') {
            article = e.target.parentNode;
        }
        else if(e.target.tagName == 'H5' || e.target.tagName == 'P') {
            article = e.target.parentNode.parentNode;
        }

        const id = article.getAttribute('data-key');
        video.innerHTML = `
            <iframe 
                width="560" 
                height="315" 
                src="https://www.youtube.com/embed/${id}"
                frameborder="0" 
                allow="accelerometer; 
                autoplay; 
                encrypted-media; 
                gyroscope; 
                picture-in-picture" 
                allowfullscreen>
            </iframe>
        `;
    });
</script>